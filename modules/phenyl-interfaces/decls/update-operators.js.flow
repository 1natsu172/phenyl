// @flow
import type { Restorable } from './restorable.js.flow' // Object
import type {
  QueryCondition,
  EqCondition,
} from './query-condition.js.flow'
import type { SortNotation } from './sort-notation.js.flow'
type DotNotationString = string

export type SetOperator = { [field: DotNotationString]: any }
export type IncOperator = { [field: DotNotationString]: number }
export type MinOperator = { [field: DotNotationString]: any }
export type MaxOperator = { [field: DotNotationString]: any }
export type MulOperator = { [field: DotNotationString]: number }
export type AddToSetOperator = { [field: DotNotationString]: any | { $each: Array<any> } }
export type PopOperator = { [field: DotNotationString]: 1 | - 1 }
export type UnsetOperator = { [field: DotNotationString]: '' }

export type PullOperator = { +[field: DotNotationString]: QueryCondition | EqCondition }

export type PushModifier = {
  $each: Array<any>,
  $slice?: number,
  $sort?: SortNotation,
  $position?: number,
}
export type PushOperator = { [field: DotNotationString]: any | PushModifier }

type TypeSpecification = true | { $type: 'timestamp' | 'date' }
export type CurrentDateOperator = { [field: DotNotationString]: TypeSpecification }
export type BitOperator = {
  [field: DotNotationString]: {
    and?: number,
    or?: number,
    xor?: number,
  }
}

/**
 * new operator which construct instances of the given path
 */
export type RestoreOperator = {
  [field: DotNotationString]: '' | Class<Restorable>
}

export type UpdateOperators = $Shape<{
  $set: SetOperator,
  $inc: IncOperator,
  $min: MinOperator,
  $max: MaxOperator,
  $mul: MulOperator,
  $addToSet: AddToSetOperator,
  $pop: PopOperator,
  $pull: PullOperator,
  $push: PushOperator,
  $currentDate: CurrentDateOperator,
  $bit: BitOperator,
  $unset: UnsetOperator,
  $restore: RestoreOperator,
}>

export type UpdateOperator =
  SetOperator |
  IncOperator |
  MinOperator |
  MaxOperator |
  MulOperator |
  AddToSetOperator |
  PopOperator |
  PullOperator |
  PushOperator |
  CurrentDateOperator |
  BitOperator |
  UnsetOperator |
  RestoreOperator
