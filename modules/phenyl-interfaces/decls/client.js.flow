// @flow
import type {
  Id
} from './id.js.flow'
import type {
  WhereQuery,
  IdQuery,
  IdsQuery,
  CustomQuery,
} from './query.js.flow'
import type { KvsClient } from './kvs-client.js.flow'
import type {
  Session,
  PreSession,
} from './session.js.flow'
import type {
  CustomQueryResultOrError,
  SingleQueryResultOrError,
  QueryResultOrError,
} from './query-result.js.flow'
import type {
  CommandResultOrError,
  CustomCommandResultOrError,
  GetCommandResultOrError,
  MultiValuesCommandResultOrError,
  LoginCommandResultOrError,
  LogoutCommandResultOrError,
} from './command-result.js.flow'
import type {
  InsertCommand,
  SingleInsertCommand,
  MultiInsertCommand,
  UpdateCommand,
  IdUpdateCommand,
  MultiUpdateCommand,
  DeleteCommand,
  CustomCommand,
  LoginCommand,
  LogoutCommand,
} from './command.js.flow'

export interface EntityClient {
  find(query: WhereQuery, sessionId?: ?Id): Promise<QueryResultOrError>,
  findOne(query: WhereQuery, sessionId?: ?Id): Promise<SingleQueryResultOrError>,
  get(query: IdQuery, sessionId?: ?Id): Promise<SingleQueryResultOrError>,
  getByIds(query: IdsQuery, sessionId?: ?Id): Promise<QueryResultOrError>,

  insert(command: InsertCommand, sessionId?: ?Id): Promise<CommandResultOrError>,
  insertAndGet(command: SingleInsertCommand, sessionId?: ?Id): Promise<GetCommandResultOrError>,
  insertAndGetMulti(command: MultiInsertCommand, sessionId?: ?Id): Promise<MultiValuesCommandResultOrError>,

  update(command: UpdateCommand, sessionId?: ?Id): Promise<CommandResultOrError>,
  updateAndGet(command: IdUpdateCommand, sessionId?: ?Id): Promise<GetCommandResultOrError>,
  updateAndFetch(command: MultiUpdateCommand, sessionId?: ?Id): Promise<MultiValuesCommandResultOrError>,

  delete(command: DeleteCommand, sessionId?: ?Id): Promise<CommandResultOrError>,
}

export interface CustomClient {
  runCustomQuery(query: CustomQuery, sessionId?: ?Id): Promise<CustomQueryResultOrError>,
  runCustomCommand(command: CustomCommand, sessionId?: ?Id): Promise<CustomCommandResultOrError>,
}

export interface AuthClient {
  login(command: LoginCommand, sessionId?: ?Id): Promise<LoginCommandResultOrError>,
  logout(command: LogoutCommand, sessionId?: ?Id): Promise<LogoutCommandResultOrError>,
}

export type SessionClient = KvsClient<Session>

export interface ClientPool {
  entityClient: EntityClient,
  sessionClient: SessionClient,
}
